import Head from 'next/head'
import styles from '../styles/register.module.css'
import React from 'react'
import { toast } from 'react-toastify'
import 'react-toastify/dist/ReactToastify.css'

const notify = (txt) => toast(txt)

export default function Register() {


  const registerUser = async event => {
    event.preventDefault()
    const { email, firstname, lastname, password } = event.target
    var formdata = new FormData()
    formdata.append('email',      email.value)
    formdata.append('first_name', firstname.value)
    formdata.append('last_name',  lastname.value)
    formdata.append('password',   password.value)
    console.log(password.value)
    try {
      const res = await globalThis.fetch(
        'http://127.0.0.1:5000/auth/register',
        {
          body: formdata,
          method: 'POST'
        },
      )
      console.log('result', res.status)
      if (res.status === 201) {
        console.log('redirect to login page')
        window.location.href = '/'
      } else {
        notify(await res.text())
      }
    } catch (e) {
      throw Error(e)
    }
  }

  return (
    <div className={styles.bgPicture}>
      <div className={styles.container}>
        <Head>
          <title>Pokélove - register</title>
          <meta name="description" content="Generated by a lot of redbull" />
          <link rel="icon" href="/logo.png" />
        </Head>

        <main className={styles.main}>

          <h1 className={styles.title}>
            Créer un compte
          </h1>
          <form onSubmit={registerUser} style={{borderColor:'white', borderWidth:'1vh'}}>
            <input id="email" name="email"
              type="text"  required
              placeholder='Email'
              style={{borderRadius:'5vh', borderWidth:'0', textAlign:'center'}}
            />
            <br/>
            <input id="firstname" name="firstname"
              type="text"  required
              placeholder='Prénom'
              style={{borderRadius:'5vh', borderWidth:'0', textAlign:'center'}}
            />
            <br/>
            <input id="lastname" name="lastname"
              type="text"  required
              placeholder='Nom de famille'
              style={{borderRadius:'5vh', borderWidth:'0', textAlign:'center'}}
            />
            <br/>
            <input
              id="password"
              name="password"
              // type="password"
              required
              pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[_\-.#^¨%,;:?!@])[a-zA-Z0-9_\-.#^¨%,;:?!@].{8,}"
              placeholder='Mot de passe'
              style={{borderRadius:'5vh', borderWidth:'0', textAlign:'center'}}
            />
            <br/>
            <button style={{color: 'white'}} type="submit" className={styles.card}>
              s'inscrire
            </button>

          </form>

          <a href="./login" className={styles.card}>
            <h2>Déjà inscrit ? &rarr;</h2>
            <p>Se connecter</p>
          </a>

        </main>
      </div>
    </div>
  )
}
